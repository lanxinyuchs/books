<!DOCTYPE html>
<html>
  <head>
    <title>Emergency Access</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Brand Assets styles -->
    <link href="./css/systemBar.css" rel="stylesheet" type="text/css"/> 
    <link href="./css/assets.css" rel="stylesheet" type="text/css"/>

    <!-- App specific styles -->
    <link href="ai.css" rel="stylesheet" type="text/css"/>

  </head>

  <script type="text/javascript">
function changeButton() {
  if (document.getElementById("host").value == "" ||
      document.getElementById("username").value == "" ||
      document.getElementById("password").value == "" ||
      document.getElementById("directory").value == "")
  {
    document.getElementById("exportButton").className = "rightAlign ebBtn ebBtn_disabled"
  }
  else
  {
    document.getElementById("exportButton").className = "rightAlign ebBtn"
  }
}

function helpWindow() {
  window.open("help_ea.html");
}

function update_values(no, client) {
  var newNo;
  var data;
  var attr; 
  if ((client.readyState == 4) && (client.status == "200"))
    {
      data = client.responseText.split("\n");
      attr = document.getElementById("nodestatus");
      attr.value = data[0];
      attr = document.getElementById("hwpid");
      attr.value = data[1];
    }
  else
  {
    if (no == 0) 
    {
      console.log("No more timouts, no updates");
    }
    else
    {
      newNo = no - 1;
      setTimeout(function(){update_values(newNo, client)}, 1000);
    }
  }
}

function update() {
  var client = new XMLHttpRequest();
  client.open('GET', 'info.txt?ms=' + new Date().getTime());
  client.send();
  setTimeout(function(){update_values(3, client)}, 500);
}

function update_result() {
  var exportresult = document.getElementById("exportresult");
  var client = new XMLHttpRequest();
  client.open('GET', 'export_esi_result.txt?ms=' + new Date().getTime());
  client.onreadystatechange = function() {
   if ((client.readyState == 4) && (client.status == "200"))
    {
      exportresult.value = client.responseText;   
    }
  }
  client.send();
}

setInterval(update_result, 5000);
  </script>

  <body onload="update()">
    
    <div id="TopMenu">
      <div class="ebSystemBar">
	<div class="ebSystemBar-logo"></div>
	<div class="ebSystemBar-topMenuName">Emergency Access</div>
      </div>
    </div>

    <button title="Opens help in new window/tab"
            class="ebIcon ebIcon_help ebIcon_interactive eb_wMargin" onclick="helpWindow()"></button>
    
    <div id="Container">
      <div class="ebLayout">

	<div class="ebLayout-AppHeading">
	  <h2>Export Ericsson Support Information (ESI) package</h2>
	  <br>
	</div>

	<div id="formdiv">
	  <form method="post" action="/cgi-bin/aicGui:post">
	    <label class="ebLabel" title="Host (IP address) where SFTP server is running">
	      <span class="ebLabel-text ebLabel-text_required">Host</span>
	      <input id="host" oninput="changeButton();" name="host" type="text" class="ebInput" placeholder="Input" required/>
	    </label>
	    <br><br>
	    <label class="ebLabel" title="Username on the SFTP server">
	      <span class="ebLabel-text ebLabel-text_required">Username</span>
	      <input id="username" oninput="changeButton();" name="username" type="text" class="ebInput" placeholder="Input" required/>
	    </label>
	    <br><br>
	    <label class="ebLabel" title="Password on the SFTP server">
	      <span class="ebLabel-text ebLabel-text_required">Password</span>
	      <input id="password" oninput="changeButton();" name="password" type="password" class="ebInput" placeholder="Input" required/>
	    </label>
	    <br><br>
	    <label class="ebLabel" title="Destination directory on the SFTP server">
	      <span class="ebLabel-text ebLabel-text_required">Directory</span>
	      <input id="directory" oninput="changeButton();" name="directory" type="text" class="ebInput_width_xLong" placeholder="Input" required/>
	    </label>
	    <br><br>
	    <label class="ebLabel" title="Shows the result of Export ESI action">
	      <span class="ebLabel-text ">Export result</span>
	      <input id="exportresult" name="exportresult" type="text" class="ebInput_width_xLong" value="-" readonly/>
	    </label>
	    <br><br>
	    <button title="Export-button creates an new ESI package and starts the ESI package export"
		    id="exportButton" name="DoESI" value="ESI" class="rightAlign ebBtn ebBtn_disabled">Export</button>
	  </form>
	</div>
	
	<br><br>
	<div class="ebLayout-AppHeading">
	  <h2>Node Information</h2>
	  <br>
	</div>

	<div id="formdiv">
	  <label class="ebLabel" title="Shows the current status of the node">
	    <span class="ebLabel-text ">Node status</span>
	    <input id="nodestatus" name="nodestatus" type="text" class="ebInput_width_xLong" value="-" readonly/>
	  </label>
	  <br><br>
	</div>
	
      </div>
    </div>
  
  </body>
</html>
