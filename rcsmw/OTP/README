##########################################################
# Need to build native OTP on RedHat type of Linux hub  #
# since Jenkins slave machines are of that type!         #
#                                                        #
# RCSCI1 functional user is currently only one           #
# with write permissions to /proj/5G_rcs/3pp!            #
##########################################################

# To check Linux host type use next command:            
lsb_release -d

#For example we have build OTP 20.1.2 on server esekilxv8959
ssh -X rcsci1@esekilxv8959

# Clone the repo
cd /repo/rcsci1/
module add git
module add gitlfs
git clone ssh://gerritmirror-ha.rnd.ki.sw.ericsson.se:29418/rcsmw/rcsmw
cd rcsmw

# Start new shell process to reset environment setup
bash

# Clean any previous build 
\rm -rf build-i586


### UPDATE OTP/update.sh with new OTP version
vi OTP/update.sh

# Source MW build environment for i686 env
source env-i586.sh

# Build SAF block
cd SAF
waf


# Output found in ../build-<target>/SAF
# Permanent links are added in ../OTP/saf/<target>/ directory
# Please make sure the libs exist before OTP build!

# Repeat for other targets

exit
bash
source env-vrcs64.sh
cd SAF
waf
exit

bash
source env-msrcs.sh
cd SAF
waf

# You cannot build OTP in same shell as env-i586.sh is sourced

exit
bash

TOPDIR=`pwd`

# Clean existing OTP and SAFE 3pp repositories if already cloned
rm -rf $TOPDIR/OTP/erlang*

git status
# Build OTP  
cd OTP
./update.sh
cd ..

# Check the build results, sym links should point on new OTP releases
ls -la OTP/tgt_i686_32
ls -la OTP/tgt_x86_64
ls -la OTP/tgt_arm-wr6
ls -la test/OTP/tgt_i686_32
ls -la test/OTP/tgt_x86_64
ls -la test/OTP/tgt_arm-wr6

# Need to update manualy env file: $TOPDIR/tools/env-host_x86_64.sh
# Update OTP variable to point on new OTP native directory
# and ERLC to point to correct public_key version

# DONE!

#git add  and commit
