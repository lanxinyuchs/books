#!/bin/sh
# script to call the  erlang shell from the unix shell
#
#  Example of call
#  rcs_erl_call  appmServer start_lm '"test_app"' 0
#  will restart the application test_app
#

Usage="Usage: $0 [-i installDir] Mod Func [Args]"

if [ $# -eq 0 ]; then
    echo $Usage
    exit 1

fi

case $1 in
    -h) 
	echo $Usage
	exit 1
	;;
    -i) 
	installDir=$2
	shift
	shift
	    ;;
    *)
	if [ ! -n "${installDir}" ]; then
	    if [ -d "/local/scratch/" ]; then
		installDir=/local/scratch/${USER}
	    elif [ -d "/repo/" ]; then
		installDir=/repo/${USER}
	    else
		installDir=/tmp/${USER}
	    fi
	fi
esac

ARCH=`arch`
if [ "${ARCH}" = ppc -o "${ARCH}" = armv7l ]; then
    OTP_ROOT=`readlink -f /home/sirpa/software/RCS*/OTP*_CXC1733859_*/otp-*/priv/tgt_*/ | head -1`
    COOKIE=rcs
    SNAME=sirpa
else 
    OTP_ROOT=${installDir}/OTP
    COOKIE=`grep COOKIE ${installDir}/RCS_ROOT/sourceMe.csh | awk '{ print $3 }'`
    SNAME=${SNAME:=$USER}
fi

ERL_CALL=`readlink -f ${OTP_ROOT}/lib/erl_interface-*/bin/erl_call`


if [ -x $ERL_CALL ]
then
    Mod=$1
    Fun=$2
    shift
    shift
    Args=$*
    ${ERL_CALL}  -c ${COOKIE} -sname $SNAME -a "${Mod} ${Fun} [$Args] " 

else
    echo "Cannot find erl_call"
fi
